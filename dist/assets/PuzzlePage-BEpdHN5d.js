import{j as t,A as E,m}from"./vendor-motion-g4hyj0Oo.js";import{c as O,r as x}from"./vendor-state-C7GhoC4r.js";import{p as P,g as $,a as M,b as U,c as _,s as L,u as H}from"./streakStore-Df38JZ8q.js";import{g as R}from"./index-BRhm_YYG.js";import"./vendor-react-D1iFKor7.js";import"./vendor-firebase-BmNtHFLu.js";function q(e,s){if(!B(e.data,s.answer))return{correct:!1,score:0,timeTaken:s.timeTaken,hintsUsed:s.hintsUsed,feedback:`Incorrect! The answer was ${e.solution}.`};const i=e.maxScore,n=Math.max(0,(e.timeLimit-s.timeTaken)/e.timeLimit),a=Math.round(n*.3*i),c=Math.round(s.hintsUsed*.15*i),o=Math.max(10,i+a-c);return{correct:!0,score:o,timeTaken:s.timeTaken,hintsUsed:s.hintsUsed,feedback:W(o,e.maxScore)}}function B(e,s){switch(e.type){case"logic":return e.options[e.correctIndex]===String(s)||e.correctIndex===Number(s);case"math":return Number(s)===e.correctAnswer;case"pattern":return Number(s)===e.correctAnswer;case"sequence":return Number(s)===e.correctAnswer;case"memory":return e.options[e.correctIndex]===String(s)||e.correctIndex===Number(s);default:return!1}}function W(e,s){const r=e/s;return r>=1.2?"üî• Incredible! Speed bonus earned!":r>=1?"‚≠ê Perfect score!":r>=.8?"‚ú® Great job!":r>=.6?"üëç Nice work!":"‚úÖ Correct!"}function F(e){if(!e||e.length===0)return"";if(e.length<100)return`RAW:${e}`;const s=new Map;let r=256;const i=[];for(let a=0;a<256;a++)s.set(String.fromCharCode(a),a);let n="";for(let a=0;a<e.length;a++){const c=e[a],o=n+c;s.has(o)?n=o:(i.push(s.get(n)),r<65536&&s.set(o,r++),n=c)}return n.length>0&&i.push(s.get(n)),"LZ:"+i.map(a=>String.fromCharCode(a)).join("")}function J(e){if(!e||e.length===0)return"";if(e.startsWith("RAW:"))return e.slice(4);if(!e.startsWith("LZ:"))return e;const s=e.slice(3),r=Array.from(s).map(o=>o.charCodeAt(0));if(r.length===0)return"";const i=new Map;let n=256;for(let o=0;o<256;o++)i.set(o,String.fromCharCode(o));let a=i.get(r[0]);const c=[a];for(let o=1;o<r.length;o++){const d=r[o];let u;if(i.has(d))u=i.get(d);else if(d===n)u=a+a.charAt(0);else throw new Error(`Decompression error: invalid code ${d}`);c.push(u),n<65536&&i.set(n++,a+u.charAt(0)),a=u}return c.join("")}const k=new Map;async function z(e){if(k.has(e))return k.get(e);try{const i=await M.get(e);if(i){const n=JSON.parse(J(i.data));return k.set(e,n),n}}catch{}const s=U(e);k.set(e,s);const r=F(JSON.stringify(s));return M.put({date:e,data:r,cachedAt:new Date().toISOString()}).catch(()=>{}),s}async function Y(){const e=$(),s=await z(e);return G(),s}async function X(e,s){const r=q(e,s),i={puzzleId:e.id,completed:r.correct,score:r.score,timeTaken:r.timeTaken,hintsUsed:r.hintsUsed,completedAt:r.correct?new Date().toISOString():null};return await P.put(i),r}async function Z(e){return P.get(e)}async function G(){const e=_(1,7);for(const s of e)await M.get(s).catch(()=>null)||await z(s)}const Q=O((e,s)=>({todayScores:{},todayTotal:0,bestScore:0,recordScore:(r,i)=>{const n=s(),a=n.todayScores[r]||0;if(i>a){const c={...n.todayScores,[r]:i},o=Object.values(c).reduce((u,j)=>u+j,0),d=Math.max(n.bestScore,i);e({todayScores:c,todayTotal:o,bestScore:d})}},loadTodayScores:async r=>{const n=(await P.getAll()).filter(d=>d.puzzleId.startsWith(r)),a={};let c=0;for(const d of n)a[d.puzzleId]=d.score,c=Math.max(c,d.score);const o=Object.values(a).reduce((d,u)=>d+u,0);e({todayScores:a,todayTotal:o,bestScore:c})}})),V=5,K="";let D=0;async function ee(){D++,D>=V&&(await te(),D=0)}async function te(){try{const e=await R();if(!e)return!1;const s=await P.getAll(),r=await L.getAll(),i=await fetch(`${K}/api/sync`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({progress:s,streaks:r,syncedAt:new Date().toISOString()})});if(!i.ok)throw new Error(`Sync failed: ${i.status}`);return!0}catch(e){return console.warn("[Sync] Failed to sync, will retry later:",e),!1}}const S=[],se=50;function ae(e,s={}){S.push({name:e,properties:s,timestamp:Date.now()}),S.length>=se&&ne()}async function ne(){if(S.length===0)return;const e=[...S];S.length=0;try{await fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e}),keepalive:!0})}catch{S.push(...e)}}function re({hints:e,hintsUsed:s,onUseHint:r}){const i=s<e.length;return t.jsxs("div",{className:"space-y-2",children:[t.jsx(E,{children:e.slice(0,s).map((n,a)=>t.jsxs(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-start gap-2 p-3 rounded-xl bg-amber-500/10 border border-amber-500/20",children:[t.jsx("span",{className:"text-amber-400 text-sm mt-0.5",children:"üí°"}),t.jsx("span",{className:"text-amber-200 text-sm",children:n})]},a))}),i&&t.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-sm text-slate-500 hover:text-amber-400 transition-colors",children:[t.jsx("span",{children:"üí°"}),"Use Hint (",s,"/",e.length,") ‚Äî costs 15% score"]}),!i&&s>0&&t.jsx("p",{className:"text-xs text-slate-600",children:"All hints used"})]})}function ie({puzzle:e,completed:s,onSubmit:r}){const[i,n]=x.useState(null),[a,c]=x.useState(0),[o,d]=x.useState(0),[u,j]=x.useState("show"),b=x.useRef(null);x.useEffect(()=>{if(s)return;const h=Date.now();return b.current=setInterval(()=>{d(Math.floor((Date.now()-h)/1e3))},1e3),()=>{b.current&&clearInterval(b.current)}},[e.id,s]),x.useEffect(()=>{if(e.data.type==="memory"&&!s){j("show");const h=setTimeout(()=>{j("answer")},e.data.displayTimeMs);return()=>clearTimeout(h)}},[e.id,e.data,s]),x.useEffect(()=>{n(null),c(0),d(0)},[e.id]);const T=x.useCallback(()=>{i===null||s||(b.current&&clearInterval(b.current),r(e,i,o,a))},[i,s,e,o,a,r]),C=x.useCallback(()=>{c(h=>Math.min(h+1,3))},[]),N=Math.max(0,e.timeLimit-o),A=N<10;return s?t.jsxs("div",{className:"glass p-8 text-center",children:[t.jsx("div",{className:"text-4xl mb-2",children:"‚úÖ"}),t.jsx("h3",{className:"text-lg font-bold text-emerald-400",children:"Completed!"}),t.jsx("p",{className:"text-slate-400 text-sm mt-1",children:"You've already solved this puzzle today"})]}):t.jsxs(m.div,{layout:!0,className:"glass p-6 space-y-5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-bold",children:e.title}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("span",{className:"text-xs text-slate-500",children:"Difficulty:"}),t.jsx("div",{className:"flex gap-0.5",children:Array.from({length:10}).map((h,v)=>t.jsx("div",{className:`w-2 h-2 rounded-full ${v<e.difficulty?"bg-brand-500":"bg-slate-800"}`},v))})]})]}),t.jsxs("div",{className:`text-2xl font-mono font-bold ${A?"text-red-400 animate-pulse":"text-slate-300"}`,children:[Math.floor(N/60),":",String(N%60).padStart(2,"0")]})]}),t.jsx("p",{className:"text-slate-300",children:e.description}),ce(e,i,n,u),t.jsx(re,{hints:e.hints,hintsUsed:a,onUseHint:C}),t.jsx(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:T,disabled:i===null,className:`w-full py-3.5 rounded-xl font-semibold text-lg transition-all ${i!==null?"bg-brand-600 hover:bg-brand-500 glow-sm":"bg-slate-800 text-slate-500 cursor-not-allowed"}`,children:"Submit Answer"}),t.jsxs("p",{className:"text-center text-xs text-slate-600",children:["Max score: ",e.maxScore," pts ‚Ä¢ Time limit: ",e.timeLimit,"s"]})]})}function ce(e,s,r,i){const n=e.data;switch(n.type){case"logic":return t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"space-y-1.5",children:n.premises.map((a,c)=>t.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[t.jsx("span",{className:"text-brand-400 mt-0.5",children:"‚Ä¢"}),t.jsx("span",{className:"text-slate-300",children:a})]},c))}),t.jsx(w,{options:n.options,selected:s,onSelect:(a,c)=>r(c)})]});case"math":return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"text-center",children:t.jsx("span",{className:"text-4xl font-mono font-bold text-gradient",children:n.expression})}),t.jsx(w,{options:n.options.map(String),selected:s!==null?String(s):null,onSelect:(a,c)=>r(Number(c))})]});case"pattern":return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"inline-grid gap-2",style:{gridTemplateColumns:`repeat(${n.grid[0].length}, 1fr)`},children:n.grid.flat().map((a,c)=>t.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center text-lg font-mono font-bold ${a===-1?"bg-brand-500/20 border-2 border-dashed border-brand-500 text-brand-400":"bg-slate-800 text-slate-200"}`,children:a===-1?"?":a},c))})}),t.jsx(w,{options:n.options.map(String),selected:s!==null?String(s):null,onSelect:(a,c)=>r(Number(c))})]});case"sequence":return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:n.sequence.map((a,c)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:`w-14 h-14 rounded-xl flex items-center justify-center text-xl font-mono font-bold ${a===null?"bg-brand-500/20 border-2 border-dashed border-brand-500 text-brand-400":"bg-slate-800 text-slate-200"}`,children:a===null?"?":a}),c<n.sequence.length-1&&t.jsx("span",{className:"text-slate-600",children:"‚Üí"})]},c))}),t.jsx(w,{options:n.options.map(String),selected:s!==null?String(s):null,onSelect:(a,c)=>r(Number(c))})]});case"memory":return t.jsx("div",{className:"space-y-4",children:i==="show"?t.jsxs(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"text-center",children:[t.jsx("p",{className:"text-sm text-slate-400 mb-3",children:"Memorize these items!"}),t.jsx("div",{className:"flex justify-center gap-3 flex-wrap",children:n.items.map((a,c)=>t.jsx(m.div,{initial:{scale:0},animate:{scale:1},transition:{delay:c*.1},className:"w-16 h-16 bg-slate-800 rounded-xl flex items-center justify-center text-3xl",children:a},c))}),t.jsx(m.div,{className:"mt-3 h-1 bg-brand-500 rounded-full",initial:{scaleX:1},animate:{scaleX:0},transition:{duration:n.displayTimeMs/1e3,ease:"linear"},style:{transformOrigin:"left"}})]}):t.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},children:[t.jsx("p",{className:"text-center text-lg font-semibold mb-3",children:n.question}),t.jsx(w,{options:n.options,selected:s,onSelect:(a,c)=>r(c)})]})});default:return null}}function w({options:e,selected:s,onSelect:r}){return t.jsx("div",{className:"grid grid-cols-2 gap-3",children:e.map((i,n)=>t.jsx(m.button,{whileHover:{scale:1.03},whileTap:{scale:.97},onClick:()=>r(n,i),className:`py-3 px-4 rounded-xl text-center font-medium transition-all ${String(s)===String(i)?"bg-brand-600 text-white glow-sm border border-brand-400":"bg-white/5 text-slate-300 hover:bg-white/10 border border-white/10"}`,children:i},`${i}-${n}`))})}function oe({score:e,maxScore:s,timeTaken:r,hintsUsed:i,correct:n}){const a=e/s,c=a>=1.2?"S":a>=1?"A":a>=.8?"B":a>=.6?"C":"D",o={S:"text-amber-400",A:"text-emerald-400",B:"text-brand-400",C:"text-blue-400",D:"text-slate-400"}[c];return n?t.jsxs(m.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:200,damping:15},className:"glass p-6 text-center",children:[t.jsx(m.div,{initial:{rotate:-10,scale:0},animate:{rotate:0,scale:1},transition:{delay:.2,type:"spring"},className:`text-6xl font-black ${o} mb-2`,children:c}),t.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"text-3xl font-bold mb-1",children:[e," ",t.jsxs("span",{className:"text-sm text-slate-500 font-normal",children:["/ ",s]})]}),t.jsxs("div",{className:"mt-4 space-y-1 text-sm text-slate-400",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"‚è± Time"}),t.jsxs("span",{children:[r,"s"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"üí° Hints Used"}),t.jsxs("span",{children:[i,"/3"]})]})]})]}):t.jsxs(m.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"glass p-6 text-center",children:[t.jsx("div",{className:"text-4xl mb-2",children:"üòî"}),t.jsx("h3",{className:"text-xl font-bold text-red-400",children:"Incorrect"}),t.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Don't worry, try the next puzzle!"})]})}const le={logic:"üß†",math:"üî¢",pattern:"üî≤",sequence:"üìà",memory:"üÉè"},de={logic:"Logic",math:"Math",pattern:"Pattern",sequence:"Sequence",memory:"Memory"};function ye(){const[e,s]=x.useState([]),[r,i]=x.useState("logic"),[n,a]=x.useState(new Set),[c,o]=x.useState(null),[d,u]=x.useState(!0),{initialize:j,recordCompletion:b}=H(),{recordScore:T,loadTodayScores:C}=Q();x.useEffect(()=>{async function l(){try{const p=await Y();s(p);const f=new Set;for(const g of p)(await Z(g.id))?.completed&&f.add(g.id);a(f),await j(),await C($())}catch(p){console.error("Failed to load puzzles:",p)}finally{u(!1)}}l()},[j,C]);const N=x.useCallback(async(l,p,f,g)=>{const y=await X(l,{puzzleId:l.id,answer:p,timeTaken:f,hintsUsed:g});o(y),y.correct&&(a(I=>new Set([...I,l.id])),T(l.id,y.score),await b(y.score),await ee(),ae("puzzle_completed",{puzzleType:l.type,score:y.score,timeTaken:f,hintsUsed:g,difficulty:l.difficulty}))},[T,b]),A=x.useCallback(()=>{o(null);const l=["logic","math","pattern","sequence","memory"],p=l.indexOf(r);for(let f=1;f<=5;f++){const g=l[(p+f)%5],y=e.find(I=>I.type===g);if(y&&!n.has(y.id)){i(g);return}}},[r,e,n]),h=e.find(l=>l.type===r),v=e.length>0&&e.every(l=>n.has(l.id));return d?t.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:t.jsx(m.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"text-4xl",children:"üß©"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[t.jsx("h2",{className:"text-2xl font-bold",children:"Today's Puzzles"}),t.jsx("p",{className:"text-slate-400 text-sm mt-1",children:new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})})]}),v&&t.jsxs(m.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"glass p-6 text-center glow",children:[t.jsx("div",{className:"text-4xl mb-2",children:"üéâ"}),t.jsx("h3",{className:"text-xl font-bold text-gradient",children:"All Puzzles Complete!"}),t.jsx("p",{className:"text-slate-400 mt-1",children:"Come back tomorrow for new challenges"})]}),t.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"flex gap-2 overflow-x-auto pb-2",children:["logic","math","pattern","sequence","memory"].map(l=>{const p=e.find(y=>y.type===l),f=p?n.has(p.id):!1,g=l===r;return t.jsxs("button",{onClick:()=>{i(l),o(null)},className:`flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-medium transition-all whitespace-nowrap ${g?"bg-brand-600 text-white glow-sm":f?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-white/5 text-slate-400 hover:bg-white/10 hover:text-white"}`,children:[t.jsx("span",{children:f?"‚úÖ":le[l]}),de[l]]},l)})}),t.jsx(E,{mode:"wait",children:c?t.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[t.jsx(oe,{score:c.score,maxScore:h?.maxScore||200,timeTaken:c.timeTaken,hintsUsed:c.hintsUsed,correct:c.correct}),t.jsx(m.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},onClick:A,className:"w-full mt-4 py-3 rounded-xl bg-brand-600 hover:bg-brand-500 font-semibold transition-colors",children:v?"üìä View Stats":"‚û°Ô∏è Next Puzzle"})]},"result"):h?t.jsx(m.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:t.jsx(ie,{puzzle:h,completed:n.has(h.id),onSubmit:N})},h.id):null})]})}export{ye as default};
