import{j as t,A as E,m}from"./vendor-motion-g4hyj0Oo.js";import{c as M,r as h}from"./vendor-state-C7GhoC4r.js";import{p as A,g as L,a as $,b as _,c as H,s as R,u as q}from"./streakStore-Df38JZ8q.js";import{g as z}from"./index--brDr9Yb.js";import"./vendor-react-D1iFKor7.js";import"./vendor-firebase-BmNtHFLu.js";function B(e,s){if(!W(e.data,s.answer))return{correct:!1,score:0,timeTaken:s.timeTaken,hintsUsed:s.hintsUsed,feedback:`Incorrect! The answer was ${e.solution}.`};const i=e.maxScore,c=Math.max(0,(e.timeLimit-s.timeTaken)/e.timeLimit),r=Math.round(c*.3*i),o=Math.round(s.hintsUsed*.15*i),n=Math.max(10,i+r-o);return{correct:!0,score:n,timeTaken:s.timeTaken,hintsUsed:s.hintsUsed,feedback:F(n,e.maxScore)}}function W(e,s){switch(e.type){case"logic":return e.options[e.correctIndex]===String(s)||e.correctIndex===Number(s);case"math":return Number(s)===e.correctAnswer;case"pattern":return Number(s)===e.correctAnswer;case"sequence":return Number(s)===e.correctAnswer;case"memory":return e.options[e.correctIndex]===String(s)||e.correctIndex===Number(s);default:return!1}}function F(e,s){const a=e/s;return a>=1.2?"üî• Incredible! Speed bonus earned!":a>=1?"‚≠ê Perfect score!":a>=.8?"‚ú® Great job!":a>=.6?"üëç Nice work!":"‚úÖ Correct!"}function G(e){if(!e||e.length===0)return"";if(e.length<100)return`RAW:${e}`;const s=new Map;let a=256;const i=[];for(let r=0;r<256;r++)s.set(String.fromCharCode(r),r);let c="";for(let r=0;r<e.length;r++){const o=e[r],n=c+o;s.has(n)?c=n:(i.push(s.get(c)),a<65536&&s.set(n,a++),c=o)}return c.length>0&&i.push(s.get(c)),"LZ:"+i.map(r=>String.fromCharCode(r)).join("")}function J(e){if(!e||e.length===0)return"";if(e.startsWith("RAW:"))return e.slice(4);if(!e.startsWith("LZ:"))return e;const s=e.slice(3),a=Array.from(s).map(n=>n.charCodeAt(0));if(a.length===0)return"";const i=new Map;let c=256;for(let n=0;n<256;n++)i.set(n,String.fromCharCode(n));let r=i.get(a[0]);const o=[r];for(let n=1;n<a.length;n++){const l=a[n];let x;if(i.has(l))x=i.get(l);else if(l===c)x=r+r.charAt(0);else throw new Error(`Decompression error: invalid code ${l}`);o.push(x),c<65536&&i.set(c++,r+x.charAt(0)),r=x}return o.join("")}const C=new Map;async function O(e){if(C.has(e))return C.get(e);try{const i=await $.get(e);if(i){const c=JSON.parse(J(i.data));return C.set(e,c),c}}catch{}const s=_(e);C.set(e,s);const a=G(JSON.stringify(s));return $.put({date:e,data:a,cachedAt:new Date().toISOString()}).catch(()=>{}),s}async function Z(){const e=L(),s=await O(e);return V(),s}async function Y(e,s){const a=B(e,s),i={puzzleId:e.id,completed:a.correct,score:a.score,timeTaken:a.timeTaken,hintsUsed:a.hintsUsed,completedAt:a.correct?new Date().toISOString():null};return await A.put(i),a}async function Q(e){return A.get(e)}async function V(){const e=H(1,7);for(const s of e)await $.get(s).catch(()=>null)||await O(s)}const X=M((e,s)=>({todayScores:{},todayTotal:0,bestScore:0,recordScore:(a,i)=>{const c=s(),r=c.todayScores[a]||0;if(i>r){const o={...c.todayScores,[a]:i},n=Object.values(o).reduce((x,p)=>x+p,0),l=Math.max(c.bestScore,i);e({todayScores:o,todayTotal:n,bestScore:l})}},loadTodayScores:async a=>{const c=(await A.getAll()).filter(l=>l.puzzleId.startsWith(a)),r={};let o=0;for(const l of c)r[l.puzzleId]=l.score,o=Math.max(o,l.score);const n=Object.values(r).reduce((l,x)=>l+x,0);e({todayScores:r,todayTotal:n,bestScore:o})}})),K=5,ee="";let I=0;async function te(){I++,I>=K&&(await se(),I=0)}async function se(){try{const e=await z();if(!e)return!1;const s=await A.getAll(),a=await R.getAll(),i=await fetch(`${ee}/api/sync`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({progress:s,streaks:a,syncedAt:new Date().toISOString()})});if(!i.ok)throw new Error(`Sync failed: ${i.status}`);return!0}catch(e){return console.warn("[Sync] Failed to sync, will retry later:",e),!1}}const j=[],ae=50;function re(e,s={}){j.push({name:e,properties:s,timestamp:Date.now()}),j.length>=ae&&ne()}async function ne(){if(j.length===0)return;const e=[...j];j.length=0;try{await fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e}),keepalive:!0})}catch{j.push(...e)}}function ie({hints:e,hintsUsed:s,onUseHint:a}){const i=s<e.length;return t.jsxs("div",{className:"space-y-2",children:[t.jsx(E,{children:e.slice(0,s).map((c,r)=>t.jsxs(m.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex items-start gap-2 p-3 rounded-xl bg-amber-500/10 border border-amber-500/20",children:[t.jsx("span",{className:"text-amber-400 text-sm mt-0.5",children:"üí°"}),t.jsx("span",{className:"text-amber-200 text-sm",children:c})]},r))}),i&&t.jsxs("button",{onClick:a,className:"flex items-center gap-2 text-sm text-slate-500 hover:text-amber-400 transition-colors",children:[t.jsx("span",{children:"üí°"}),"Use Hint (",s,"/",e.length,") ‚Äî costs 15% score"]}),!i&&s>0&&t.jsx("p",{className:"text-xs text-slate-600",children:"All hints used"})]})}function ce({puzzle:e,onSubmit:s}){const[a,i]=h.useState(null),[c,r]=h.useState(0),[o,n]=h.useState(e.timeLimit),[l,x]=h.useState(e.type==="memory"?"memorize":"solve"),p=h.useRef(null);h.useEffect(()=>(i(null),r(0),n(e.timeLimit),x(e.type==="memory"?"memorize":"solve"),p.current&&clearInterval(p.current),p.current=setInterval(()=>{n(b=>b<=1?(clearInterval(p.current),0):b-1)},1e3),()=>clearInterval(p.current)),[e]),h.useEffect(()=>{if(e.type==="memory"&&l==="memorize"){const b=setTimeout(()=>{x("solve")},e.data.displayTimeMs);return()=>clearTimeout(b)}},[e,l]);const N=()=>r(b=>Math.min(b+1,3)),S=()=>{a!==null&&(clearInterval(p.current),s(e,a,e.timeLimit-o,c))},w=o<=10;return t.jsxs(m.div,{layout:!0,className:"glass p-8 space-y-8",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h3",{className:"text-2xl font-black tracking-tight",children:e.title}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"flex gap-1",children:Array.from({length:10}).map((b,k)=>t.jsx("div",{className:`w-1.5 h-3 rounded-full transition-all duration-500 ${k<e.difficulty?"bg-brand-500 shadow-[0_0_8px_rgba(79,70,229,0.5)]":"bg-white/10"}`},k))}),t.jsxs("span",{className:"text-[10px] uppercase tracking-widest font-bold text-slate-500",children:["Difficulty ",e.difficulty,"/10"]})]})]}),t.jsxs("div",{className:"relative w-16 h-16 flex items-center justify-center",children:[t.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[t.jsx("circle",{cx:"32",cy:"32",r:"28",stroke:"currentColor",strokeWidth:"4",fill:"transparent",className:"text-white/5"}),t.jsx(m.circle,{cx:"32",cy:"32",r:"28",stroke:"currentColor",strokeWidth:"4",strokeDasharray:"176",initial:{strokeDashoffset:176},animate:{strokeDashoffset:176*(1-o/e.timeLimit)},fill:"transparent",className:w?"text-red-500":"text-brand-500",transition:{duration:1,ease:"linear"}})]}),t.jsxs("div",{className:`absolute inset-0 flex items-center justify-center font-mono font-bold text-xs ${w?"text-red-400 animate-pulse":"text-slate-300"}`,children:[o,"s"]})]})]}),t.jsx("div",{className:"p-4 bg-white/[0.02] border border-white/5 rounded-2xl",children:t.jsxs("p",{className:"text-slate-400 text-sm leading-relaxed italic",children:['"',e.description,'"']})}),t.jsx("div",{className:"py-2",children:oe(e,a,i,l)}),t.jsxs("div",{className:"space-y-6 pt-4 border-t border-white/5",children:[t.jsx(ie,{hints:e.hints,hintsUsed:c,onUseHint:N}),t.jsx(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:S,disabled:a===null,className:"btn-primary w-full disabled:bg-slate-800 disabled:text-slate-500 shadow-xl",children:"Validate Solution"}),t.jsxs("div",{className:"flex justify-between items-center text-[10px] uppercase tracking-widest font-black text-slate-600",children:[t.jsxs("span",{children:["Target: ",e.maxScore," pts"]}),t.jsxs("span",{children:["Limit: ",e.timeLimit,"s"]})]})]})]})}function oe(e,s,a,i){const{type:c,data:r}=e;switch(c){case"logic":return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"space-y-3",children:r.premises.map((o,n)=>t.jsxs("div",{className:"flex gap-4 p-4 bg-white/[0.03] rounded-2xl border border-white/5",children:[t.jsxs("span",{className:"text-brand-500 font-bold",children:["#0",n+1]}),t.jsx("p",{className:"text-slate-200 text-sm",children:o})]},n))}),t.jsx(v,{options:r.options,selected:s,onSelect:(o,n)=>a(n)})]});case"math":return t.jsxs("div",{className:"space-y-6 text-center",children:[t.jsx("div",{className:"text-5xl font-black font-mono tracking-tighter py-6 text-white drop-shadow-md",children:r.expression}),t.jsx(v,{options:r.options,selected:s,onSelect:(o,n)=>a(n)})]});case"pattern":return t.jsxs("div",{className:"space-y-8",children:[t.jsx("div",{className:"grid grid-cols-3 gap-3 w-48 mx-auto",children:r.grid.map((o,n)=>o.map((l,x)=>t.jsx("div",{className:`aspect-square rounded-xl flex items-center justify-center text-xl font-bold border-2 ${l===-1?"bg-brand-600/20 border-brand-500/50 text-brand-400 animate-pulse":"bg-white/5 border-white/5 text-slate-300"}`,children:l===-1?"?":l},`${n}-${x}`)))}),t.jsx(v,{options:r.options,selected:s,onSelect:(o,n)=>a(n)})]});case"sequence":return t.jsxs("div",{className:"space-y-8",children:[t.jsx("div",{className:"flex justify-center gap-3",children:r.sequence.map((o,n)=>t.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center text-xl font-black border-2 ${o===null?"bg-brand-600/20 border-brand-500 border-dashed text-brand-500 animate-pulse":"bg-white/5 border-white/5 text-slate-300 shadow-inner"}`,children:o===null?"?":o},n))}),t.jsx(v,{options:r.options,selected:s,onSelect:(o,n)=>a(n)})]});case"memory":return i==="memorize"?t.jsxs("div",{className:"space-y-6 text-center py-8",children:[t.jsx("div",{className:"text-6xl flex justify-center gap-4",children:r.items.map((o,n)=>t.jsx(m.span,{initial:{scale:0},animate:{scale:1},transition:{delay:n*.1},children:o},n))}),t.jsx("div",{className:"w-full bg-white/5 h-1 rounded-full overflow-hidden max-w-xs mx-auto",children:t.jsx(m.div,{initial:{width:"100%"},animate:{width:"0%"},transition:{duration:r.displayTimeMs/1e3,ease:"linear"},className:"h-full bg-brand-500"})}),t.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500 font-black",children:"Hold focus..."})]}):t.jsx("div",{className:"space-y-8",children:t.jsxs("div",{className:"text-center",children:[t.jsxs("p",{className:"text-xl font-bold text-white mb-6",children:['"',r.question,'"']}),t.jsx(v,{options:r.options,selected:s,onSelect:(o,n)=>a(n)})]})});default:return null}}function v({options:e,selected:s,onSelect:a}){return t.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.map((i,c)=>{const r=String(s)===String(i);return t.jsxs(m.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:()=>a(c,i),className:`relative py-4 px-6 rounded-2xl text-center font-bold transition-all duration-300 border-2 ${r?"bg-brand-600/20 border-brand-500 text-white shadow-lg shadow-brand-500/20":"bg-white/[0.02] border-white/5 text-slate-400 hover:border-white/20 hover:text-slate-200"}`,children:[r&&t.jsx(m.div,{layoutId:"option-check",className:"absolute top-2 right-2 w-2 h-2 bg-brand-400 rounded-full glow-sm"}),t.jsx("span",{className:"relative z-10",children:i})]},`${i}-${c}`)})})}function le({result:e,onNext:s}){if(!e)return t.jsx("div",{className:"glass p-10 text-center text-slate-500 italic",children:"Retrieving performance metrics..."});const a=e.rating==="S";return t.jsxs(m.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},className:"glass overflow-hidden",children:[t.jsxs("div",{className:`relative h-40 flex items-center justify-center overflow-hidden ${e.correct?"bg-brand-600":"bg-slate-800"}`,children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-brand-500 to-purple-600 opacity-80"}),t.jsxs(m.div,{initial:{scale:0,rotate:-20},animate:{scale:1,rotate:0},transition:{type:"spring",damping:12,delay:.2},className:"relative z-10 flex flex-col items-center",children:[t.jsx("span",{className:`text-8xl font-black drop-shadow-2xl ${a?"text-yellow-300 animate-pulse":"text-white"}`,children:e.rating||(e.correct?"A":"F")}),t.jsx("div",{className:"absolute -top-6 -right-6 text-3xl",children:a?"üëë":e.correct?"‚ú®":"‚ùå"})]}),t.jsx(m.div,{animate:{scale:[1,1.2,1],rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},className:"absolute -bottom-20 -left-20 w-64 h-64 bg-white/10 rounded-full blur-3xl opacity-30"})]}),t.jsxs("div",{className:"p-10 space-y-10",children:[t.jsxs("div",{className:"text-center space-y-3",children:[t.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.4em] text-slate-500",children:"Daily Performance Log"}),t.jsx(m.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5},className:`text-6xl font-black ${e.correct?"text-gradient":"text-slate-500"}`,children:e.correct?`+${e.score}`:"0 PTS"}),t.jsxs("p",{className:"text-slate-400 text-sm italic mt-2 px-4 leading-relaxed",children:['"',e.feedback||"Try again to improve your score!",'"']})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[t.jsx(D,{label:"Time",value:`${e.timeTaken||0}s`,icon:"‚è±Ô∏è"}),t.jsx(D,{label:"Hints",value:e.hintsUsed>0?`${e.hintsUsed} Used`:"Zero",icon:"üí°"})]}),t.jsxs(m.button,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:s,className:"btn-primary w-full flex items-center justify-center gap-4 text-xl",children:[t.jsx("span",{children:"CONTINUE"}),t.jsx("span",{className:"opacity-70",children:"‚Üí"})]})]})]})}function D({label:e,value:s,icon:a}){return t.jsxs("div",{className:"p-5 bg-white/[0.03] border border-white/5 rounded-3xl space-y-2 group transition-all duration-300 hover:bg-white/[0.06]",children:[t.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-brand-400 transition-colors",children:[t.jsx("span",{className:"text-sm",children:a}),e]}),t.jsx("div",{className:"text-2xl font-black text-white",children:s})]})}const de={logic:"üß†",math:"üî¢",pattern:"üî≤",sequence:"üìà",memory:"üÉè"},me={logic:"Logic",math:"Math",pattern:"Pattern",sequence:"Sequence",memory:"Memory"};function ye(){const[e,s]=h.useState([]),[a,i]=h.useState("logic"),[c,r]=h.useState(new Set),[o,n]=h.useState(null),[l,x]=h.useState(!0),{initialize:p,recordCompletion:N}=q(),{recordScore:S,loadTodayScores:w}=X();h.useEffect(()=>{async function d(){try{const f=await Z();s(f);const u=new Set;for(const g of f)(await Q(g.id))?.completed&&u.add(g.id);r(u),await p(),await w(L())}catch(f){console.error("Failed to load puzzles:",f)}finally{x(!1)}}d()},[p,w]);const b=h.useCallback(async(d,f,u,g)=>{const y=await Y(d,{puzzleId:d.id,answer:f,timeTaken:u,hintsUsed:g});n(y),y.correct&&(r(P=>new Set([...P,d.id])),S(d.id,y.score),await N(y.score),await te(),re("puzzle_completed",{puzzleType:d.type,score:y.score,timeTaken:u,hintsUsed:g,difficulty:d.difficulty}))},[S,N]),k=h.useCallback(()=>{n(null);const d=["logic","math","pattern","sequence","memory"],f=d.indexOf(a);for(let u=1;u<=5;u++){const g=d[(f+u)%5],y=e.find(P=>P.type===g);if(y&&!c.has(y.id)){i(g);return}}},[a,e,c]),T=e.find(d=>d.type===a),U=e.length>0&&e.every(d=>c.has(d.id));return l?t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[t.jsx(m.div,{animate:{scale:[1,1.2,1],rotate:[0,180,360]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"text-6xl",children:"üß©"}),t.jsx("div",{className:"text-slate-500 font-mono text-xs uppercase tracking-widest animate-pulse",children:"Generating Puzzles..."})]}):t.jsxs("div",{className:"space-y-8 max-w-2xl mx-auto",children:[t.jsxs("header",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-3xl font-black tracking-tight text-white",children:"CHALLENGES"}),t.jsx("p",{className:"text-slate-400 text-xs font-mono uppercase tracking-[0.2em] mt-1",children:new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"})})]}),U&&t.jsxs("div",{className:"px-4 py-1 bg-emerald-500/10 border border-emerald-500/20 rounded-full flex items-center gap-2",children:[t.jsx("span",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),t.jsx("span",{className:"text-xs font-bold text-emerald-400 uppercase tracking-wider",children:"All Clear"})]})]}),t.jsx("div",{className:"p-1.5 bg-white/5 backdrop-blur-md rounded-2xl border border-white/5 flex gap-1 overflow-x-auto no-scrollbar",children:["logic","math","pattern","sequence","memory"].map(d=>{const f=e.find(y=>y.type===d),u=f?c.has(f.id):!1,g=d===a;return t.jsxs("button",{onClick:()=>{i(d),n(null)},className:`relative flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 whitespace-nowrap ${g?"text-white":u?"text-emerald-400 hover:text-emerald-300":"text-slate-500 hover:text-slate-300"}`,children:[g&&t.jsx(m.div,{layoutId:"active-tab",className:"absolute inset-0 bg-brand-600 rounded-xl shadow-lg shadow-brand-600/20",transition:{type:"spring",bounce:.2,duration:.6}}),t.jsx("span",{className:"relative z-10",children:u?"‚úì":de[d]}),t.jsx("span",{className:"relative z-10 tracking-tight",children:me[d]})]},d)})}),t.jsx(E,{mode:"wait",children:o?t.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:t.jsx(le,{result:o,onNext:k})},"result"):T?t.jsx(m.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:t.jsx(ce,{puzzle:T,completed:c.has(T.id),onSubmit:b})},T.id):null})]})}export{ye as default};
